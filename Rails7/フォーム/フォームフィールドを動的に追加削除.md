例：userテーブルのhobbies（趣味）カラムに対するフォームを動的に追加削除できるようにする
![image](https://github.com/user-attachments/assets/a26104a3-89e0-41e3-9a3f-b6caede17710)　　⇒　　![image](https://github.com/user-attachments/assets/dcef045d-33ca-448b-8a21-98480730de5c)

1. 必要なgemの追加
Gemfileに以下を追加します。

```
gem "importmap-rails"
gem "stimulus-rails"
```
その後、以下のコマンドを実行します。

```
bundle
```
2. importmap/stimulusのインストール
以下のコマンドを実行します。

```
docker compose run web rails importmap:install
docker compose run web rails stimulus:install
```
3. Stimulusコントローラの作成
以下のコマンドを実行してStimulusコントローラを作成します。

```
rails g stimulus hobbies
```
作成されたhobbies_controller.jsを以下のように編集します。

```
import { Controller } from "@hotwired/stimulus"

// Connects to data-controller="hobbies"
export default class extends Controller {
  static targets = ["container", "template"]

  addField(event) {
    event.preventDefault()
    const content = this.templateTarget.innerHTML.replace(/TEMPLATE_RECORD/g, new Date().valueOf())
    this.containerTarget.insertAdjacentHTML("beforeend", content)
  }

  removeField(event) {
    event.preventDefault()
    if (this.containerTarget.childElementCount > 1) {
      event.target.closest(".nested-fields").remove()
    }
  }
}
```
4. フォームの編集
フォームのHTMLを以下のように編集します。

```
<%= form_with(model: user, local: true) do |form| %>

  <h3>趣味</h3>
  <div data-controller="hobbies">
    <div data-hobbies-target="container">
      <%= form.fields_for :hobbies do |hobby_form| %>
        <div class="nested-fields">
          <%= hobby_form.label :name, "趣味" %>
          <%= hobby_form.text_field :name, value: hobby_form.object.name %>
          <a href="#" data-action="click->hobbies#removeField">-</a>
        </div>
      <% end %>
    </div>
    <a href="#" data-action="click->hobbies#addField">+</a>
    <template data-hobbies-target="template">
      <div class="nested-fields">
        <%= form.fields_for :hobbies, Hobby.new, child_index: "TEMPLATE_RECORD" do |hobby_form| %>
          <%= hobby_form.label :name, "趣味" %>
          <%= hobby_form.text_field :name %>
          <a href="#" data-action="click->hobbies#removeField">-</a>
        <% end %>
      </div>
    </template>
  </div>

  <div class="actions">
    <%= form.submit user.new_record? ? "登録" : "保存" %>
  </div>
<% end %>

```
